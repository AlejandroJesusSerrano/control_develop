{% extends 'body.html' %}
{% load static %}

{% block extra_refs %}
<!-- Select2 -->
<link rel="stylesheet" href="{% static 'lib/select2-4.1.0/css/select2.min.css' %}">
<script src="{% static '../static/lib/select2-4.1.0/js/select2.min.js' %}"></script>
{% endblock extra_refs %}

{% block content %}
<form method="post" action="." enctype="multipart/form-data" id="{{form_id}}" class="container">
  <div class="card card-default mb-2">
    <div class="card-header {{bg_color}}">
      <h3 class="card-title">

        {% if action == 'add' %}
          <i class="fa-regular fa-square-plus"></i>
        {% else %}
          <i class="fa-regular fa-edit"></i>
        {% endif %}

      {{title}}
      </h3>
    </div>

    <div class="card-body table-responsive">

        {% csrf_token %}
        <input type="hidden" name="action" value="{{ action }}">
        {% for field in form.visible_fields %}
        <div class="form-group">
          <label>{{ field.label }}: </label>
          {% if field.errors %}

              <div class="alert alert-danger alert-dismissible">
                <h5><i class="icon fas fa-triangle-exclamation"></i> Ha Ocurrido un Error!</h5>
                {{ field.errors }}
                </div>

          {% endif %}
          {{ field }}
        </div>
        {% endfor %}

    </div>
    <div class="card-footer">

      {% block add_button %}
      <button type="submit" class="btn btn-primary" id="{{btn_add_id}}">
        <i class="fas fa-save"></i> Guardar Registro
      </button>
      <a href="{{ list_url }}" type="submit" class="btn btn-danger" id="{{btn_add_id}}">
        <i class="fas fa-circle-arrow-left"></i> Regresar a listado
      </a>
      {% endblock add_button %}

    </div>
  </div>
</form>
<script>

  $('select2').select2({
    
  });

  $(document).ready(function() {

    $('#{{form_id}}').on('submit', function(e) {
      e.preventDefault()

      let params = new FormData(this);

      params.forEach(function (value, key){
        console.log(key+': '+value);
      })

      let actionType = "{{ action }}"

      submit_whit_ajax(window.location.pathname, params, function(data){
        window.location.href = '{{ list_url }}'
      }, actionType);
    });
  });
</script>

{% endblock content %}