{% extends 'body.html' %}
{% load static %}

{% block extra_refs %}
<!-- Select2 -->
<link rel="stylesheet" href="{% static 'lib/select2-4.1.0-rc.0/dist/css/select2.min.css' %}">
<link rel="stylesheet" href="{% static 'lib/select2-4.1.0-rc.0/dist/css/select2-bootstrap.min.css' %}">
<script src="{% static 'lib/select2-4.1.0-rc.0/dist/js/select2.full.min.js' %}"></script>
{% endblock extra_refs %}

{% block content %}
<form method="post" action="." enctype="multipart/form-data" id="{{form_id}}" data-list-url="{{ list_url }}" class="container" data-form-id="{{form_id}}">
  {% csrf_token %}
  <div class="card card-default mb-2">
    <div class="card-header {{bg_color}}">
      <h3 class="card-title">

        {% if action == 'add' %}
          <i class="fa-regular fa-square-plus"></i>
        {% else %}
          <i class="fa-regular fa-edit"></i>
        {% endif %}

      {{title}}
      </h3>
    </div>

    <div class="card-body table-responsive">

        <input type="hidden" name="action" value="{{ action }}">

        {% block form %}
        {% endblock form %}

        {% if form.errors %}

              <div class="alert alert-danger alert-dismissible">
                <h5><i class="icon fas fa-triangle-exclamation"></i> Ha Ocurrido un Error!</h5>
                <ul>
                  {% for field, errors in form.errors.items %}

                  <li><strong>{{ form[field].label_tag }}: </strong> {{errors|join:", "}}</li>

                  {% endfor %}
                </ul>
                </div>

          {% endif %}
          {{ field }}
        </div>

        <div class="card-footer">

          {% block add_button %}
          <button type="submit" class="btn btn-primary" id="{{btn_add_id}}">
            <i class="fas fa-save"></i> Guardar Registro
          </button>
          <a href="{{ list_url }}" type="submit" class="btn btn-danger" id="{{btn_add_id}}">
            <i class="fas fa-circle-arrow-left"></i> Regresar a listado
          </a>
          {% endblock add_button %}

        </div>

    </div>
  </div>
</form>
{% block form_scripts %}

{% endblock form_scripts %}
<script>

    $('#{{form_id}}').on('submit', function(e) {
      e.preventDefault()

      let params = new FormData(this);

      params.forEach(function (value, key){
        console.log(key+': '+value);
      })

      let actionType = "{{ action }}"

      submit_with_ajax(window.location.pathname, params, function(data){
        window.location.href = '{{ list_url }}'
      }, actionType);
    });

</script>

{% endblock content %}